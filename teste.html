<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>App Pai com Iframe</title>
  <style>
    iframe {
      width: 100%;
      height: 50vh;
      border: 2px solid red;
    }
  </style>
</head>
<body>
  <h1>Testando o Iframe do Board</h1>

  <iframe id="board-frame" src="./dist/index.html"></iframe>
<script type="module">
  const iframe = document.getElementById("board-frame");

  async function loadAndSendData() {
    try {
      const response = await fetch('./data.json');
      const world = await response.json();

      // Extrai os campos do mundo
      const { timelines, storyLines, chapters, papers } = world;

      // Cria mapa de cores por paper_id
      const paperColorMap = new Map(
        (papers || []).map(p => [p.id, p.color])
      );

      // Atribui color a cada capÃ­tulo com base no paper_id
      const coloredChapters = (chapters || []).map(ch => ({
        ...ch,
        color: paperColorMap.get(ch.paper_id) || "#CCCCCC"
      }));

      iframe.contentWindow.postMessage({
        type: "set-data",
        data: {
          timelines,
          storylines: storyLines, // ðŸ‘ˆ Ajustado: no JSON estÃ¡ como "storyLines"
          chapters: coloredChapters
        }
      }, "*");

      iframe.contentWindow.postMessage({
        type: "set-light",
        data: {
          light: false
        }
      }, "*");

    } catch (err) {
      console.error("âŒ Erro ao carregar ou processar data.json:", err);
    }
  }

  iframe.addEventListener("load", loadAndSendData);

  // Listener de retorno do iframe
  window.addEventListener("message", (event) => {
    console.log('..')
    const { type, data } = event.data || {};
    if (type === "chapter-option-selected") {
      console.log("ðŸŸ¢ UsuÃ¡rio clicou:", data);
    } else if (type === "chapter-focus") {
      console.log("ðŸŸ¢ UsuÃ¡rio focou ->:", data);
    } else if (type === "board-transform-update") {
      console.log("ðŸŸ¢ TransformaÃ§Ã£o do board ->:", data);
    }
  });
</script>



</body>
</html>
